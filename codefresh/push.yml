version: 1.0
mode: parallel
stages:
  - install
  - lint
  - build
  - test
steps:
  clone:
    description: Cloning repository...
    type: git-clone
    stage: install
    repo: vallerance/react-orcus
    revision: ${{CF_BRANCH}}
  install:
    title: Build react-orcus docker image
    type: build
    stage: install
    image_name: react-orcus
    tag: ${{CF_BRANCH_TAG_NORMALIZED}}
    working_directory: ${{clone}}
    registry: github-container-registry-vallerance
    when:
      steps:
        - name: clone
          on:
  build-lint:
    title: Building lint image
    type: build
    stage: lint
    image_name: react-orcus-lint
    tag: ${{CF_BRANCH_TAG_NORMALIZED}}
    working_directory: ${{clone}}
    dockerfile: codefresh/lint.Dockerfile
    build_arguments:
      - VERSION=${{CF_BRANCH_TAG_NORMALIZED}}
    registry: github-container-registry-vallerance
    when:
      steps:
        - name: install
  lint:
    title: Linting source
    stage: lint
    image: ${{build-lint}}
    working_directory: IMAGE_WORK_DIR
    when:
      steps:
        - name: build-lint
  build:
    title: Building library
    type: build
    stage: build
    image_name: react-orcus-build
    tag: ${{CF_BRANCH_TAG_NORMALIZED}}
    working_directory: ${{clone}}
    dockerfile: codefresh/build.Dockerfile
    build_arguments:
      - VERSION=${{CF_BRANCH_TAG_NORMALIZED}}
    registry: github-container-registry-vallerance
    when:
      steps:
        - name: install
  build-test:
    title: Building test image
    type: build
    stage: test
    image_name: react-orcus-test
    tag: ${{CF_BRANCH_TAG_NORMALIZED}}
    working_directory: ${{clone}}
    dockerfile: codefresh/test.Dockerfile
    build_arguments:
      - VERSION=${{CF_BRANCH_TAG_NORMALIZED}}
    registry: github-container-registry-vallerance
    when:
      steps:
        - name: build
  test:
    title: Running tests
    stage: test
    image: ${{build-test}}
    working_directory: IMAGE_WORK_DIR
    when:
      steps:
        - name: build-test
          on:
